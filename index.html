<!doctype html>
<html lang="ko">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>교사용 홈</title>
<style>
:root{--bg1:#dff0ff;--bg2:#eaf6ff;--ink:#0f172a;--pri:#0ea5e9;--priD:#0284c7;--good:#16a34a;--bad:#ef4444}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ink)}
.wrap{max-width:960px;margin:0 auto;padding:20px}
h1{margin:0 0 8px}
.card{background:#fff;border:1px solid #d7e7f5;border-radius:16px;padding:16px;margin:12px 0}
.btn{padding:12px 16px;border:0;border-radius:12px;background:var(--pri);color:#fff;font-weight:900;cursor:pointer}
.btn:hover{background:var(--priD)}
.row{display:flex;gap:10px;flex-wrap:wrap}
.state{display:inline-block;padding:2px 10px;border-radius:999px;font-weight:800}
.state.on{background:#d1fae5;color:#065f46}
.state.off{background:#fee2e2;color:#991b1b}
.sel{padding:10px;border-radius:12px;border:1px solid #cbd5e1;background:#fff}
.note{font-size:12px;color:#334155}
</style>
<body>
<div class="wrap">
  <h1>교사용 홈 <span id="vState" class="state off">손님</span></h1>
  <div class="card">
    <h3>학급</h3>
    <div class="row">
      <button class="btn" onclick="goDashboard()">나의 학급 들어가기</button>
      <button class="btn" onclick="unbindDevice()">이 기기 연결 해제</button>
    </div>
    <div class="note">연결 해제는 이 기기의 저장정보만 지웁니다(서버 학급은 유지). 완전 초기화는 대시보드에서 수행하세요.</div>
  </div>

  <div class="card">
    <h3>수업(문항 선택 → 캡쳐)</h3>
    <div class="row">
      <select id="prob" class="sel">
        <option value="02_위험찾기">02_위험찾기</option>
        <option value="03_화재대피안전수칙">03_화재대피안전수칙</option>
        <option value="04_비상구로대피">04_비상구로대피</option>
        <option value="05_옷에불이붙었어요">05_옷에불이붙었어요</option>
        <option value="06_119신고하기">06_119신고하기</option>
        <option value="07_소화기사용법">07_소화기사용법</option>
        <option value="08_완강기사용법">08_완강기사용법</option>
      </select>
      <button class="btn" onclick="goCapture()">수업하기</button>
      <button class="btn" onclick="toggleMode()">모드: <span id="vMode">B</span></button>
    </div>
    <div class="note">A모드(자동분류)는 승인 기관만 사용. 토글 시 링크에 자동 반영됩니다.</div>
  </div>
</div>

<script>
const qs = new URLSearchParams(location.search);
const mode = (qs.get('mode') || localStorage.getItem('mode') || 'b').toLowerCase()==='a'?'a':'b';
localStorage.setItem('mode', mode);
document.getElementById('vMode').textContent = mode.toUpperCase();

function repoBase(){ const segs=location.pathname.split('/').filter(Boolean); return segs.length?('/'+segs[0]):''; }
function goDashboard(){ location.href = repoBase() + '/dashboard.html'; }
function goCapture(){
  const p = document.getElementById('prob').value;
  const ap = (localStorage.getItem('mode')||'b').toLowerCase()==='a' ? '&mode=a' : '';
  location.href = repoBase() + '/capture.html?problem=' + encodeURIComponent(p) + ap;
}
function toggleMode(){
  const cur = (localStorage.getItem('mode')||'b').toLowerCase();
  const next = (cur==='a') ? 'b' : 'a';
  localStorage.setItem('mode', next);
  document.getElementById('vMode').textContent = next.toUpperCase();
  alert('모드가 ' + next.toUpperCase() + '로 전환되었습니다.');
}
function unbindDevice(){
  if(!confirm('이 기기의 연결정보를 삭제하고 손님모드로 전환합니다. 진행할까요?')) return;
  ['tk','teacherKey','schoolId','classId','faceDB'].forEach(k=>localStorage.removeItem(k));
  drawState();
}
function drawState(){
  const on = !!(localStorage.getItem('tk')||localStorage.getItem('teacherKey'));
  const el = document.getElementById('vState');
  el.textContent = on ? '연결됨' : '손님';
  el.className = 'state ' + (on?'on':'off');
}
drawState();
</script>
</body>
</html>
