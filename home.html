<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>교사 홈(세션 생성)</title>
<style>
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif; padding:16px; line-height:1.5}
  input, textarea{padding:8px; border:1px solid #ddd; border-radius:8px; width:100%; max-width:520px}
  textarea{min-height:120px}
  button{padding:10px 16px; border:0; border-radius:10px; font-weight:700; background:#111; color:#fff; margin-top:8px}
  .links a{display:block; margin:8px 0; padding:10px; background:#f4f4f4; border-radius:10px; text-decoration:none; color:#111}
  .note{font-size:12px; opacity:.75}
</style>

<body>
  <h2>교사 홈</h2>

  <div>
    <div>반 이름</div>
    <input id="klass" placeholder="예: 무지개반" />

    <div style="margin-top:10px">초기 아동(선택, 가명/번호)</div>
    <input id="child" placeholder="예: 3번 (선택)" />

    <div style="margin-top:10px">학급 명단(한 줄에 한 명, 선택)</div>
    <textarea id="roster" placeholder="예)\n민준\n서윤\n지호\n..."></textarea>

    <button id="create">세션 만들기</button>
    <div id="msg" class="note" style="margin-top:8px"></div>
  </div>

  <h3 style="margin-top:20px">문제 링크</h3>
  <div class="links" id="links">
    <div class="note">세션을 먼저 만들면 여기에 버튼이 나타납니다.</div>
  </div>

<script>
// ★ Apps Script /exec 주소(넣어둠)
const SESSION_API = "https://script.google.com/macros/s/AKfycbwxQdrD9d358f1OWhIzC54f4pnCArgmNqx4LQqBpsYDlUnRAJU_A5hqdVZnnO5tIhHcOA/exec";

// 7개 성취(2~8)
const PROBLEMS = [
  { id:"02_위험찾기",         title:"2) 위험 찾기" },
  { id:"03_화재대피안전수칙", title:"3) 화재 대피 안전수칙" },
  { id:"04_비상구로대피",     title:"4) 비상구로 대피하기" },
  { id:"05_옷에불이붙었어요", title:"5) 옷에 불이 붙었어요" },
  { id:"06_119신고하기",      title:"6) 119 신고하기" },
  { id:"07_소화기사용법",     title:"7) 소화기 사용법" },
  { id:"08_완강기사용법",     title:"8) 완강기 사용법" }
];

const links = document.getElementById('links');
const msg   = document.getElementById('msg');

document.getElementById('create').onclick = async ()=>{
  const klass  = document.getElementById('klass').value.trim();
  const child  = document.getElementById('child').value.trim();
  const roster = document.getElementById('roster').value.trim();
  if (!klass){ alert('반 이름을 입력하세요'); return; }

  const fd = new FormData();
  fd.append('action','createSession');
  fd.append('classId', klass);
  fd.append('child',   child);
  fd.append('roster',  roster);

  try{
    const res = await fetch(SESSION_API, { method:'POST', body:fd });
    const j = await res.json();
    if (!j.sid){ alert('세션 생성 실패:\n'+JSON.stringify(j)); return; }

    msg.textContent = `세션 준비 완료(유효기간 ~ ${j.expiresAt}). 아래 버튼으로 문제를 여세요.`;

    links.innerHTML = '';
    PROBLEMS.forEach(p=>{
      const a = document.createElement('a');
      a.textContent = p.title;
      // ★ 문제 화면은 teachercapture 저장소의 루트(index.html)로 연결
      a.href = `https://seol-glitter.github.io/teachercapture/?sid=${encodeURIComponent(j.sid)}&problem=${encodeURIComponent(p.id)}`;
      a.target = '_blank';
      links.appendChild(a);
    });
  }catch(e){
    alert('네트워크 오류:\n'+e);
  }
};
</script>
</body>
